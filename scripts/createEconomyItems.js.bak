const OUTPUT_PATH = './scripts/test'

const { readdirSync, writeFileSync } = require('fs')

console.log('[1/4] - Creating EconomyItems typings for MongoDB version...')

const types = ['json', 'mongodb']
const sources = ['src', 'typings']
const initialDirectories = ['managers']

let text = ''

for (const type of types) {
    for (const source of sources) {
        const directories = [...initialDirectories]

        const [outputFileExtension, sliceLength] =
            source == 'src' ?
                ['js', -3] :
                ['d.ts', -3]

        for (const directory of directories) {
            const files = readdirSync(`.${type == 'mongodb' ? '/mongodb' : ''}/src/${directory}`)

            const lineText = (fileName) =>
                source == 'typings'
                    ? `export import ${fileName} = require('./${source}/${directory}/${fileName}')`
                    : `${fileName}: require('./${source}/${directory}/${fileName}')`

            text = files
                .map(fileName => fileName.slice(0, sliceLength))
                .map(fileName => lineText(fileName))
                .sort()
                .join('\n')
                + '\n\n'
        }

        writeFileSync(`${OUTPUT_PATH}/test-${type}.${outputFileExtension}`, text)
    }
}


console.log('Done!')
